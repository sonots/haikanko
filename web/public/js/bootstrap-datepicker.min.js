!function(a){var b=function(b,d){this.element=a(b);this.format=c.parseFormat(d.format||this.element.data("date-format")||"mm/dd/yyyy");this.picker=a(c.template).appendTo("body").on({click:a.proxy(this.click,this),mousedown:a.proxy(this.mousedown,this)});this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):false;if(this.isInput){this.element.on({focus:a.proxy(this.show,this),blur:a.proxy(this.hide,this),keyup:a.proxy(this.update,this)})}else{if(this.component){this.component.on("click",a.proxy(this.show,this))}else{this.element.on("click",a.proxy(this.show,this))}}this.viewMode=0;this.weekStart=d.weekStart||this.element.data("date-weekstart")||0;this.weekEnd=this.weekStart==0?6:this.weekStart-1;this.fillDow();this.fillMonths();this.update();this.showMode()};b.prototype={constructor:b,show:function(b){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();a(window).on("resize",a.proxy(this.place,this));if(b){b.stopPropagation();b.preventDefault()}if(!this.isInput){a(document).on("mousedown",a.proxy(this.hide,this))}this.element.trigger({type:"show",date:this.date})},hide:function(){this.picker.hide();a(window).off("resize",this.place);this.viewMode=0;this.showMode();if(!this.isInput){a(document).off("mousedown",this.hide)}this.setValue();this.element.trigger({type:"hide",date:this.date})},setValue:function(){var a=c.formatDate(this.date,this.format);if(!this.isInput){if(this.component){this.element.find("input").prop("value",a)}this.element.data("date",a)}else{this.element.prop("value",a)}},place:function(){var a=this.component?this.component.offset():this.element.offset();this.picker.css({top:a.top+this.height,left:a.left})},update:function(){this.date=c.parseDate(this.isInput?this.element.prop("value"):this.element.data("date"),this.format);this.viewDate=new Date(this.date);this.fill()},fillDow:function(){var a=this.weekStart;var b="<tr>";while(a<this.weekStart+7){b+='<th class="dow">'+c.dates.daysMin[a++%7]+"</th>"}b+="</tr>";this.picker.find(".datepicker-days thead").append(b)},fillMonths:function(){var a="";var b=0;while(b<12){a+='<span class="month">'+c.dates.monthsShort[b++]+"</span>"}this.picker.find(".datepicker-months td").append(a)},fill:function(){var a=new Date(this.viewDate),b=a.getFullYear(),d=a.getMonth(),e=this.date.valueOf();this.picker.find(".datepicker-days th:eq(1)").text(c.dates.months[d]+" "+b);var f=new Date(b,d-1,28,0,0,0,0),g=c.getDaysInMonth(f.getFullYear(),f.getMonth());f.setDate(g);f.setDate(g-(f.getDay()-this.weekStart+7)%7);var h=new Date(f);h.setDate(h.getDate()+42);h=h.valueOf();html=[];var i;while(f.valueOf()<h){if(f.getDay()==this.weekStart){html.push("<tr>")}i="";if(f.getMonth()<d){i+=" old"}else if(f.getMonth()>d){i+=" new"}if(f.valueOf()==e){i+=" active"}html.push('<td class="day'+i+'">'+f.getDate()+"</td>");if(f.getDay()==this.weekEnd){html.push("</tr>")}f.setDate(f.getDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(html.join(""));var j=this.date.getFullYear();var k=this.picker.find(".datepicker-months").find("th:eq(1)").text(b).end().find("span").removeClass("active");if(j==b){k.eq(this.date.getMonth()).addClass("active")}html="";b=parseInt(b/10,10)*10;var l=this.picker.find(".datepicker-years").find("th:eq(1)").text(b+"-"+(b+9)).end().find("td");b-=1;for(var m=-1;m<11;m++){html+='<span class="year'+(m==-1||m==10?" old":"")+(j==b?" active":"")+'">'+b+"</span>";b+=1}l.html(html)},click:function(b){b.stopPropagation();b.preventDefault();var d=a(b.target).closest("span, td, th");if(d.length==1){switch(d[0].nodeName.toLowerCase()){case"th":switch(d[0].className){case"switch":this.showMode(1);break;case"prev":case"next":this.viewDate["set"+c.modes[this.viewMode].navFnc].call(this.viewDate,this.viewDate["get"+c.modes[this.viewMode].navFnc].call(this.viewDate)+c.modes[this.viewMode].navStep*(d[0].className=="prev"?-1:1));this.fill();break}break;case"span":if(d.is(".month")){var e=d.parent().find("span").index(d);this.viewDate.setMonth(e)}else{var f=parseInt(d.text(),10)||0;this.viewDate.setFullYear(f)}this.showMode(-1);this.fill();break;case"td":if(d.is(".day")){var g=parseInt(d.text(),10)||1;var e=this.viewDate.getMonth();if(d.is(".old")){e-=1}else if(d.is(".new")){e+=1}var f=this.viewDate.getFullYear();this.date=new Date(f,e,g,0,0,0,0);this.viewDate=new Date(f,e,g,0,0,0,0);this.fill();this.setValue();this.element.trigger({type:"changeDate",date:this.date})}break}}},mousedown:function(a){a.stopPropagation();a.preventDefault()},showMode:function(a){if(a){this.viewMode=Math.max(0,Math.min(2,this.viewMode+a))}this.picker.find(">div").hide().filter(".datepicker-"+c.modes[this.viewMode].clsName).show()}};a.fn.datepicker=function(c){return this.each(function(){var d=a(this),e=d.data("datepicker"),f=typeof c=="object"&&c;if(!e){d.data("datepicker",e=new b(this,a.extend({},a.fn.datepicker.defaults,f)))}if(typeof c=="string")e[c]()})};a.fn.datepicker.defaults={};a.fn.datepicker.Constructor=b;var c={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(a){return a%4===0&&a%100!==0||a%400===0},getDaysInMonth:function(a,b){return[31,c.isLeapYear(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]},parseFormat:function(a){var b=a.match(/[.\/-].*?/),c=a.split(/\W+/);if(!b||!c||c.length==0){throw new Error("Invalid date format.")}return{separator:b,parts:c}},parseDate:function(a,b){var c=a.split(b.separator),a=new Date(1970,1,1,0,0,0),d;if(c.length==b.parts.length){for(var e=0,f=b.parts.length;e<f;e++){d=parseInt(c[e],10)||1;switch(b.parts[e]){case"dd":case"d":a.setDate(d);break;case"mm":case"m":a.setMonth(d-1);break;case"yy":a.setFullYear(2e3+d);break;case"yyyy":a.setFullYear(d);break}}}return a},formatDate:function(a,b){var c={d:a.getDate(),m:a.getMonth()+1,yy:a.getFullYear().toString().substring(2),yyyy:a.getFullYear()};c.dd=(c.d<10?"0":"")+c.d;c.mm=(c.m<10?"0":"")+c.m;var a=[];for(var d=0,e=b.parts.length;d<e;d++){a.push(c[b.parts[d]])}return a.join(b.separator)},headTemplate:"<thead>"+"<tr>"+'<th class="prev"><i class="icon-arrow-left"/></th>'+'<th colspan="5" class="switch"></th>'+'<th class="next"><i class="icon-arrow-right"/></th>'+"</tr>"+"</thead>",contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};c.template='<div class="datepicker dropdown-menu">'+'<div class="datepicker-days">'+'<table class=" table-condensed">'+c.headTemplate+"<tbody></tbody>"+"</table>"+"</div>"+'<div class="datepicker-months">'+'<table class="table-condensed">'+c.headTemplate+c.contTemplate+"</table>"+"</div>"+'<div class="datepicker-years">'+'<table class="table-condensed">'+c.headTemplate+c.contTemplate+"</table>"+"</div>"+"</div>"}(window.jQuery)
